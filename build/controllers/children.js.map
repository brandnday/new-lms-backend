{"version":3,"sources":["../../src/controllers/children.js"],"names":["isActive","list","ctx","request","body","nickname","registeredAt","pagination","queryParam","mainQuery","pgPool","query","page","size","res","resCount","ok","response","rows","totalData","count","add","requestData","name","gender","address","father","mother","school","parentphone","phone","photo","imgloc","birthdate","attendanceid","registered_at","update","graduated","editingId","deactivate"],"mappings":"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","file":"children.js","sourcesContent":["import { pgPool } from \"../services/database\";\n\nconst isActive = `status = 'A'`;\nexport const list = async ctx => {\n  const { nickname = \"\", registeredAt, pagination } = ctx.request.body;\n  const queryParam = [`%${nickname}%`];\n  const mainQuery = `from mschildren \n  where nickname like $1\n  and registered_at = ${registeredAt}\n  and ${isActive}`;\n\n  const res = await pgPool.query(\n    `select nickname,gender,address, birthdate ${mainQuery}\n    ORDER BY id\n    OFFSET ${(pagination.page - 1) * pagination.size} LIMIT ${pagination.size}`,\n    queryParam\n  );\n\n  const resCount = await pgPool.query(\n    `select count(*) ${mainQuery}`,\n    queryParam\n  );\n  ctx.ok({ response: { rows: res.rows, totalData: resCount.rows[0].count } });\n};\n\nexport const add = async ctx => {\n  const {\n    name,\n    nickname,\n    gender,\n    address,\n    father,\n    mother,\n    school,\n    phone: parentphone,\n    photo: imgloc = \"NONE\",\n    birthdate,\n    attendanceid,\n    registered_at\n  } = ctx.request.body.requestData;\n  const res = await pgPool.query(\n    `INSERT INTO mschildren(\n      name,nickname,gender,address,\n      father,mother,school,parentphone,\n      imgloc,graduated,birthdate,status,attendanceid,\n      registered_at)\n  values($1,$2,$3,$4,\n    $5,$6,$7, $8,\n    $9,$10,$11,'A',$12,$13)`,\n    [\n      name,\n      nickname,\n      gender,\n      address,\n      father,\n      mother,\n      school,\n      parentphone,\n      imgloc,\n      \"N\",\n      birthdate,\n      attendanceid,\n      registered_at\n    ]\n  );\n  ctx.ok({ response: res.rows });\n};\n\nexport const update = async ctx => {\n  const {\n    nickname,\n    gender,\n    address,\n    father,\n    mother,\n    school,\n    parentphone,\n    imgloc = \"NONE\",\n    graduated,\n    birthdate,\n    registered_at,\n    editingId\n  } = ctx.request.body.requestData;\n  const res = await pgPool.query(\n    `UPDATE mschildren SET\n  nickname = $1,\n  gender = $2,\n  address = $3,father = $4,mother = $5,\n  school = $6,\n  parentphone = $7,\n  imgloc = $8,\n  graduated = $9,\n  birthdate = $10',\n  status = 'A',\n  registered_at = $11\n  where id = $12`,\n    [\n      nickname,\n      gender,\n      address,\n      father,\n      mother,\n      school,\n      parentphone,\n      imgloc,\n      graduated,\n      birthdate,\n      registered_at,\n      editingId\n    ]\n  );\n  ctx.ok({ response: res.rows });\n};\n\nexport const deactivate = async ctx => {\n  const { editingId } = ctx.request.body.requestData;\n  const res = await pgPool.query(\n    `update mschildren set status='D'\n  where id=$1`,\n    [editingId]\n  );\n  ctx.ok({ response: res.rows });\n};\n"]}